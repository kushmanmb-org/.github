# EIP-7981: Increase Access List Cost

## Overview

**EIP Number**: 7981  
**Title**: Increase Access List Cost  
**Author**: Toni Wahrstätter (@nerolation)  
**Status**: Draft  
**Type**: Standards Track  
**Category**: Core  
**Created**: 2024-12-27  
**Requires**: [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930), [EIP-7623](https://eips.ethereum.org/EIPS/eip-7623), [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976)

## Abstract

This EIP charges access lists for their data footprint, preventing the circumvention of the [EIP-7623](https://eips.ethereum.org/EIPS/eip-7623) and [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976) floor pricing. This effectively reduces the worst-case block size by ~21% with minimal impact on users.

## Motivation

Access lists are only priced for storage but not for their data.

Furthermore, access lists can circumvent the [EIP-7623](https://eips.ethereum.org/EIPS/eip-7623) and [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976) floor pricing by contributing to EVM gas while still leaving a non-negligible data footprint. This enables achieving the maximal possible block size by combining access lists with calldata at a certain ratio.

## Specification

### Parameters (Aligned with EIP-7976)

| Parameter                              | Value | Source |
| -------------------------------------- | ----- | ------ |
| `ACCESS_LIST_ADDRESS_COST`            | `2400` | [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930) |
| `ACCESS_LIST_STORAGE_KEY_COST`        | `1900` | [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930) |
| `TOTAL_COST_FLOOR_PER_TOKEN`          | `16`   | [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976) ⚠️ **Updated from 10** |
| `STANDARD_TOKEN_COST`                 | `4`    | [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976) |

> **Note**: This EIP has been aligned with EIP-7976's updated `TOTAL_COST_FLOOR_PER_TOKEN` value of `16` (previously `10` in EIP-7623).

### Access List Token Calculation

Let `access_list_nonzero_bytes` and `access_list_zero_bytes` be the count of non-zero and zero bytes respectively in the addresses (20 bytes each) and storage keys (32 bytes each) contained within the access list.

Let `tokens_in_access_list = access_list_zero_bytes + access_list_nonzero_bytes * 4`.

### Updated Access List Cost Formula

The access list cost formula changes from [EIP-2930](https://eips.ethereum.org/EIPS/eip-2930) to include data cost:

```python
access_list_cost = (
    ACCESS_LIST_ADDRESS_COST * access_list_addresses
    + ACCESS_LIST_STORAGE_KEY_COST * access_list_storage_keys
    + TOTAL_COST_FLOOR_PER_TOKEN * tokens_in_access_list
)
```

### Floor Calculation with Access Lists

The [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976) floor calculation is modified to include access list tokens:

```python
tokens_in_calldata = zero_bytes_in_calldata + nonzero_bytes_in_calldata * 4
floor_tokens_in_calldata = (zero_bytes_in_calldata + nonzero_bytes_in_calldata) * 4
total_data_tokens = floor_tokens_in_calldata + tokens_in_access_list

data_floor_gas_cost = TX_BASE_COST + TOTAL_COST_FLOOR_PER_TOKEN * total_data_tokens
```

### Gas Used Calculation

The gas used calculation becomes:

```python
tx.gasUsed = (
    21000
    +
    max(
        STANDARD_TOKEN_COST * tokens_in_calldata
        + execution_gas_used
        + isContractCreation * (32000 + INITCODE_WORD_COST * words(calldata))
        + access_list_cost,
        TOTAL_COST_FLOOR_PER_TOKEN * total_data_tokens
    )
)
```

Any transaction with a gas limit below `21000 + TOTAL_COST_FLOOR_PER_TOKEN * total_data_tokens` or below its intrinsic gas cost is considered invalid.

## Rationale

Access list data is always charged at floor rate (added to `access_list_cost`), and access list tokens are included in the floor calculation. This ensures:

- Access list data always pays floor rate regardless of execution level
- Access lists cannot be used to bypass the calldata floor pricing
- Consistent pricing across all transaction data sources
- **Alignment with EIP-7976's updated floor pricing** (`TOTAL_COST_FLOOR_PER_TOKEN = 16`)

## Alignment with EIP-7976

### Key Changes

This document reflects the alignment with [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976), which updated the floor pricing from the original [EIP-7623](https://eips.ethereum.org/EIPS/eip-7623) values:

| Parameter | EIP-7623 (Original) | EIP-7976 (Updated) | This EIP |
|-----------|--------------------|--------------------|----------|
| `TOTAL_COST_FLOOR_PER_TOKEN` | `10` | `16` | **`16`** ✅ |
| `STANDARD_TOKEN_COST` | `4` | `4` | `4` |

### Impact of Alignment

With `TOTAL_COST_FLOOR_PER_TOKEN = 16`:

1. **Access list data costs increase by 60%** (from 10 to 16 gas per token)
2. **Better block size control**: More effective reduction of worst-case block size
3. **Consistent pricing**: Access lists now use the same floor rate as calldata
4. **Enhanced security**: Closes the loophole more effectively

## Reference Implementation

```python
def calculate_access_list_tokens(access_list: Tuple[Access, ...]) -> Uint:
    """Count data tokens in access list addresses and storage keys."""
    zero_bytes = Uint(0)
    nonzero_bytes = Uint(0)

    for access in access_list:
        for byte in access.account:
            if byte == 0:
                zero_bytes += Uint(1)
            else:
                nonzero_bytes += Uint(1)
        for slot in access.slots:
            for byte in slot:
                if byte == 0:
                    zero_bytes += Uint(1)
                else:
                    nonzero_bytes += Uint(1)

    return zero_bytes + nonzero_bytes * Uint(4)


def calculate_intrinsic_cost(tx: Transaction) -> Tuple[Uint, Uint]:
    """
    Calculate intrinsic gas cost and floor gas cost.
    Returns (intrinsic_gas, floor_gas).
    
    Updated to align with EIP-7976: TOTAL_COST_FLOOR_PER_TOKEN = 16
    """
    # Calldata tokens
    calldata_zero_bytes = Uint(0)
    for byte in tx.data:
        if byte == 0:
            calldata_zero_bytes += Uint(1)
    tokens_in_calldata = (
        calldata_zero_bytes + (ulen(tx.data) - calldata_zero_bytes) * Uint(4)
    )
    floor_tokens_in_calldata = ulen(tx.data) * Uint(4)

    # Access list tokens and cost
    tokens_in_access_list = Uint(0)
    access_list_cost = Uint(0)
    if has_access_list(tx):
        tokens_in_access_list = calculate_access_list_tokens(tx.access_list)
        for access in tx.access_list:
            access_list_cost += TX_ACCESS_LIST_ADDRESS_COST
            access_list_cost += ulen(access.slots) * TX_ACCESS_LIST_STORAGE_KEY_COST
        # EIP-7981: Always charge data cost (aligned with EIP-7976)
        access_list_cost += tokens_in_access_list * TOTAL_COST_FLOOR_PER_TOKEN  # 16

    # EIP-7981: Floor includes all data tokens
    total_data_tokens = floor_tokens_in_calldata + tokens_in_access_list
    floor_gas = TX_BASE_COST + total_data_tokens * TOTAL_COST_FLOOR_PER_TOKEN  # 16

    # Intrinsic gas
    calldata_cost = tokens_in_calldata * STANDARD_TOKEN_COST  # 4
    create_cost = TX_CREATE_COST + init_code_cost(tx.data) if is_create(tx) else Uint(0)

    intrinsic_gas = TX_BASE_COST + calldata_cost + create_cost + access_list_cost

    return intrinsic_gas, floor_gas
```

## Impact on kushmanmb-org Operations

### Transaction Cost Changes

For kushmanmb-org's blockchain operations:

1. **Transactions with Access Lists**:
   - Access list data now costs **16 gas per token** (up from 10)
   - This affects transactions that use access lists for gas optimization
   - Impact: **60% increase** in access list data costs

2. **Regular Transactions** (without access lists):
   - Subject to EIP-7976 calldata floor pricing only
   - No additional impact from EIP-7981

### Recommended Actions

- **Review Access List Usage**: Audit transactions that use access lists
- **Update Gas Estimation**: Account for `TOTAL_COST_FLOOR_PER_TOKEN = 16` in both calldata and access lists
- **Monitor Costs**: Track gas costs in workflows that may use access lists
- **Wallet Updates**: Ensure wallet software uses updated gas estimation

### Affected Workflows

The following workflows should be reviewed for access list usage:

- **crypto-consolidation.yml**: May use access lists for gas optimization
- **balance-monitor.yml**: Gas cost tracking must account for access list costs
- **tx-verification.yml**: Transaction validation with updated gas calculations

## Backwards Compatibility

This is a backwards incompatible gas repricing that requires a scheduled network upgrade.

Requires updates to gas estimation in wallets and nodes. Normal usage patterns remain largely unaffected.

## Security Considerations

This EIP closes a loophole that allows circumventing [EIP-7623](https://eips.ethereum.org/EIPS/eip-7623) and [EIP-7976](https://eips.ethereum.org/EIPS/eip-7976) floor pricing. Without this fix, attackers can achieve larger blocks than intended by combining access lists with calldata. All transaction data sources now contribute to the floor calculation consistently.

With the alignment to EIP-7976's `TOTAL_COST_FLOOR_PER_TOKEN = 16`, the security benefits are enhanced:

- **Stronger block size constraints**: 60% higher floor cost for access list data
- **Better DoS protection**: More expensive to create large access lists
- **Consistent pricing model**: All data sources use the same floor rate

## References

- [EIP-7981 Official Specification](https://eips.ethereum.org/EIPS/eip-7981)
- [EIP-7976: Increase Calldata Floor Cost](https://eips.ethereum.org/EIPS/eip-7976) - **Dependency**
- [EIP-7623: Increase calldata cost](https://eips.ethereum.org/EIPS/eip-7623)
- [EIP-2930: Optional access lists](https://eips.ethereum.org/EIPS/eip-2930)
- [Ethereum Magicians Discussion](https://ethereum-magicians.org/t/eip-7981-increase-access-list-cost/24680)

## Related Documentation

- [EIP_7976.md](EIP_7976.md) - EIP-7976 documentation (dependency)
- [CRYPTO_CONSOLIDATION.md](CRYPTO_CONSOLIDATION.md) - Gas optimization strategies
- [IMPLEMENTATION_SUMMARY.md](IMPLEMENTATION_SUMMARY.md) - EIP support summary

---

*Documentation Date: 2026-02-21*  
*Status: Draft - Aligned with EIP-7976*  
*Relevant to: Ethereum Mainnet, Base, Optimism, Arbitrum*  
*Alignment Update: `TOTAL_COST_FLOOR_PER_TOKEN` updated from `10` to `16` (EIP-7976)*
